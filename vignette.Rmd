---
title: "Welcome to {midsprint}"
author: "Aaron Pearson and Dani Chu"
date: "2021-01-07"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using midsprint}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r load data backend, include = F, eval = T, echo = F}
library(midsprint)

load("~/midsprint/player_a_dominant.rda")
load("~/midsprint/player_s_dominant.rda")
```

```{r profile data backen, include = F, eval=T}
player_a_data <- profile_data(10.39, 15.6)
player_b_data <- profile_data(10.7, 7.49)
player_a_profile <- player_profile(player_a_data)
player_b_profile <- player_profile(player_b_data)
```

### In-Game F-V-P Profiling

This package was built to compliment the NFL Big Data Bowl 2021 Submission "5 Seconds or Less: Modeling Player Biomechanics to Predict Pass Outcomes" [[submission](https://www.kaggle.com/haljordan/modeling-player-biomechanics)]. Presently, this package is fairly rudimentary.

{midsprint} alows you to model an athlete's kinetic and kinematic sprint mechanics *in-situ*. Building player-profiles provides sports practitioners insight into an athlete's neuromuscular lower-limb potential. {midsprint} is does not encompass the force-velocity-power profile completely.

The submission [[link](https://www.kaggle.com/haljordan/modeling-player-biomechanics)] and package are the first to model athletes while in motion. Previous methods required that athletes' start a run with zero velocity.

Dependencies: {lamW}

### {midsprint} Workflow

The following examples are written with and without the arguments expressed explicitly.

### Load Package

```{r, echo = T}
library(midsprint)
```

### Loading Player Data

This package comes with two sample data sets: **player_a** and **player_b**. player_a is **acceleration** dominant whereas player_b is **speed** dominant. The example below shows you how to work with the sample data and load your own data sets.

#### Sample Data

```{r load sample data, eval = F}
player_a <- data(player_a)
player_b <- data(player_b)
```

#### Loading Data

The following example assumes you are reading data in from a .csv file. Please ensure that the top row in your .csv file contains the column names. Some positional tracking data files display athlete information preceding the data. You can either manually delete this data or use the {janitor} package to clean the data sets.

```{r load data, eval = F}
player_a <- read.csv("~/data folder/player_a.csv")
player_b <- read.csv("~/data folder/player_b.csv")
```

### Preparing the Data

This step partially cleans the data. You may want to clean the data before this step. Many times, posiitonal tracking data includes a lot of noise that can result in unrealistic speed and acceleration values. The {tidyverse} package contains many functions that are simple to use.

The *profile_data()* function has two arguments: speed and acceleration. You will need to pass the speed and acceleration vectors to this function.

You will need to save each function to its own object. It is prudent to save each step with similar object names. It is not suggested to overwrite objects with each step.

```{r prepare data, eval=F, warning=FALSE}
player_a_data <- profile_data(speed = player_a$speed, 
                              acceleration = player_a$accel)

player_b_data <- profile_data(player_b$speed, player_b$accel)
```

Viewing player profile data:

The player profile is built using *player_profile()*. This step is imperative: you must pass the player's profile data for all remaining functions.

```{r player profiling, eval = F}
player_a_profile <- player_profile(profile_data = player_a_data)
player_b_profile <- player_profile(player_b_data)
```

Viewing player profiles:

```{r, include = F}
player_a_profile <- data.frame(Max.Observed.Player.Speed = 10.39,
  Max.Observed.Player.Acceleration = 15.6,
  Player.Tau.Value = 0.6660256)
player_b_profile <- data.frame(Max.Observed.Player.Speed = 13.4,
  Max.Observed.Player.Acceleration = 9.2,
  Player.Tau.Value = 1.3447826)
```

```{r}
player_a_profile
```

### Plotting Player Sprint Kinetics

The following graphs plot velocity-time (v(t)) and acceleration-time (a(t)).

```{r player plots, fig.height=5, fig.width=7, fig.align='center'}
player_a_plot <- player_plot(player_profile = player_a_profile)
player_b_plot <- player_plot(player_b_profile)
```

#### Comparing Player Sprint Kinetics

```{r,include = F}
compare_player_plot <- function(player_profile_1, player_profile_2) {
    
    p1 <- compare_plot1(player_profile_1)
    
    par(mfrow = c(1,1))
    
    p1
    lines(speed ~ split_time, player_plot_values(player_profile_2), col = "red")
    lines(acceleration ~ split_time, player_plot_values(player_profile_2), col = "red")
    
    recordPlot(p1)
    
}
```

```{r comparison plot, fig.width=7, fig.height=5, fig.align='center'}
player_a_b_compare_plot <- compare_player_plot(player_profile_1 = player_a_profile, 
                                               player_profile_2 = player_b_profile)
```

### Projecting Time to a Position

This function does not require that the athlete begins with zero velocity. The following examples illustrate the athletes' times to run 40 yards starting velocities of 0 yd/s and 5 yd/s.

#### Zero Velocity

```{r, include = F}
time_to_position <- function(player_profile, current_speed, distance) {
    
    time_to_dist <- time_to_dist_given_speed(player_profile, distance, current_speed)
    round(time_to_dist, 2)
    
    
}
```

```{r time projection zero}
player_a_40_yd <- time_to_position(player_profile = player_a_profile, 
                                   current_speed = 0, 
                                   distance = 40)

player_b_40_yd <- time_to_position(player_b_profile, 0, 40)
```

Zero velocity results:

```{r, include = T, echo = F}
# Player B
player_a_40_yd
# Player B
player_b_40_yd
```

#### While in Motion

```{r time projection motion}
player_a_midsprint <- time_to_position(player_profile = player_a_profile, 
                                       current_speed = 5, 
                                       distance = 40)

player_b_midsprint <- time_to_position(player_b_profile, 5, 40)
```

While in motion results:

```{r, echo = F}
player_a_midsprint
player_b_midsprint
```

### Comparing Player Projected Times

This function is similar to *time_to_position*. The NFL Big Data Bowl 2021 [[submission](https://www.kaggle.com/haljordan/modeling-player-biomechanics)] hinged on *compare_time_to_position*. Again, the following examples illustrate times to run 40 yards starting with velocities of 0 yd/s and 5 yd/s.

#### Zero Velocity

```{r, include = F}
compare_time_to_position <- function(time_to_position_1, time_to_position_2) {
    
    str1 <- "Player 1:"
    str2 <- "Player 2:"
    seconds <- "seconds."
    
    result1 <- paste(str1, time_to_position_1, seconds)
    result2 <- paste(str2, time_to_position_2, seconds)
    
    c(result1, result2)
    
}
```

```{r compare time projection zero}
compare_a_b_40_yd <- compare_time_to_position(time_to_position_1 = player_a_40_yd, 
                                             time_to_position_2 = player_b_40_yd)
```

Comparison with zero velocity results:

```{r, echo = F}
compare_a_b_40_yd
```

#### While in Motion

```{r compare time projection motion}
compare_a_b_midsprint <- compare_time_to_position(player_a_midsprint, player_b_midsprint)
```

Comparison while in motion results:

```{r, echo = F}
compare_a_b_midsprint
```

### Future Work

This package will be updated to include:

-   More visualization

-   Expansions on player f-v-p profiling

-   Increased number of helper functions

This package will continue being built with minimal dependencies.

For questions or concerns, please reach out to Aaron Pearson at [aaronzpearson\@outlook.com](aaronzpearson@outlook.com)
